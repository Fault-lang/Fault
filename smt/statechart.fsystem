system statechart;

import "simple.fspec";

global flow = new simple.fl;

def drain = component{
    initial: state{
        if !flow.active {
            flow.active = true;
            advance(this.open);
        }
    },
    open: state{
        if flow.vault.value < 0 {
            advance(this.close);
        }
    },
    close: state{
        flow.active = false;
    },
};

start { 
    drain: initial,
};

for 5 run {
    if !drain.close{
        flow.fn;
    }
}